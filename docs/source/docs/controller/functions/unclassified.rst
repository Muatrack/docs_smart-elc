功能介绍(未归类)
++++++++++++++++++

数据报表1
=========

.. toctree::
    feature-report

数据可视化
==============

电气数据
*************

空调电气数据 *入口* [#空调电气数据]_
--------------------------------------

    电气数据(用电数据)的上传, 由多种事件驱动，即当某一事件发生时会触发电气数据的及时上报至平台, 平台提供相关数据的可视化。
    所涉及的事件及处理如下表所示:

    * **空调电气数据**: 

        - 空调通电、断电、开机、关机 : 事件发生后第 **5秒** , 产生空调电气数据报文并上报至平台
        - 压缩机 启动、停止 : 事件发生后第 **5秒** , 产生空调电气数据报文并上报至平台
        
        上述事件发生时，其事件的报文会即刻发送至平台。收到报文后，平台会记录事件发生的时间和对应数据，此类事件的数据可视化 *入口* [#电气可视化数据入口]_

    * **分闸（空调机入电断开）时**

        分闸状态是指，采集器的出线连接至空调场景下， 采集器的出线供电断开，同时采集器的入线供电正常(以确保采集器能够正常工作)。    
        分闸状态下,空调的电气数据上报周期为 **1小时** ，即每间隔1小时上报一次数据。

    * **空调关机时**

        空调关机状态，采集器、空调机的供电正常，但空调的工作状态置为 **关机** （采集器发出关机指令到空调机）。
        空调关机状态时，其电气数据上报周期为 **30分钟** ，即每间隔30分钟上报一次数据

    * **空调待机时**

        空调待机状态，采集器、空调机的供电正常，但空调的工作状态置为 **待机** （采集器发出关机指令到空调机）。
        空调关机状态时，其电气数据上报周期为 **15分钟** ，即每间隔15分钟 上报一次数据

    * **压缩机运行时**

        空调机中含有压缩机，在工作过程中可能运转、停止运转，以实现制冷温控的目的。
        压缩机正在运行时，空调电气数据上报周期为 **5分钟** ,j即每间隔5分钟上报一次数据

电量统计数据
--------------------------------------
    * 在小时内0、15、30、45分, 23点最后一次的上报时间设置为23:59

    电量统计数据，该值的计算按照规定，在北京时间的整刻钟记取。即北京时间每天00:00开始每间隔15分钟记取一次并上传。
    考虑项目实施数据拥堵情况，该数据按照规定整刻钟记取，数据上传将在数据记取后的3分钟内发出。

    * e.g. 记取的电量统计数据的时刻为 01:15，平台端接收到此数据的时间将会在 01:15 - 01:18 范围内完成。

压缩机状态
--------------------------------------
    随空调制冷过程温度的变化，压缩机可能处于 *运行状态* 、 *停止状态* 。对于压缩机的上述状态，
    按照以下策略控制器将产生对应的报文，且及时上传至平台。

    * 状态改变时：即当 *运行状态* 与 *停止状态* 发生切换时，压缩机状态的报文立即产生并上报至平台。
    * 没有变化：当压缩机处于同一状态 *运行状态* 或 *停止状态* 持续时间较长时，每间隔 **1小时** 压缩机状态报文产生并上报至平台。
    * 零点跨天：北京时间，每天的0点，上报一次压缩机的状态。减缓数据拥堵，00:00 报文生成后非立即发送，在00:03前上报。
    * 视图路径: *设备管理->站点设备信息->目标站点->数据报表->设备数据->启停时间*
        .. image:: /_static/imags/air-conditioner_perform_times.png
            :width: 80%

        *如上图所示:
        (1)、(2) 所指向的小点点，时终端上传的数据值和时间。(1)所指向的位置是，当日时间(00:00)开始上传的点子，后续点子(向右)的时间依次增大。
        (2)所示的点子是当天最后上传的点子。*
    
开关机状态
--------------------------------------
    空调开关机，即空调机入电连通时，其工作状态可为 *开机* 和 *关机*。视图 二值量数据-线图_
    
    * 当执行开机切换为关机，或关机切换为开机时，产生对应的状态报文上报平台。
    * 系统时间每天走到00:00 时生成一条报文上报平台。减缓数据拥堵，00:00 报文生成后非立即发送，在00:03前上报。

控制与检测状态
--------------------------------------
    * 空调开关机、压缩机运行   **待议-内容重复**
    * 节能模式状态变化时及时同步
    * 系统时间每天走到00:00 时生成一条报文上报平台。减缓数据拥堵，00:00 报文生成后非立即发送，在00:03前上报。

温度传感器曲线
--------------------------------------
    温度曲线采样: 温度传感器定时采样，新采样数据与已存在数据的最前值对比得出温度差值，以此判断采样温差。
    温度曲线数据上报时，将多个采样数据打包发送至平台，并将采样的时间一并上报。

    数据上报的时机，温度曲线数组包的上报时机受两个因素影响，分别是 “温差"和“时长”。
    
    * 温差: 以 **1℃** 为界限，当采样温度与最前值温差 **>=** 1℃，即可将当前已采样数据集合打包上报平台。
    * 时长: 若采样数据集合中，采样温度的温差未超过1℃时，采样数据将不会上报平台，此种情况比较新采样时间与最前值的采样时间差，当 **>=** 20分钟 即可将采样数据集合打包上传之平台。

人体传、光线传感器数据 *入口* [#人体及光线可视化]_
----------------------------------------------------
    当传感器感应到有人活动，便触发 **人体存在** 的告警。传感器组件当中同时集成了光线传感器，即当光线的流明变化会引起 **光线** 变化告警。

    * **人体存在** 触发:  当有人进入传感器作用范围，此时将打包 **人体传感器实际状态、光线流明值** 上报到平台。
    * **光线** : 当光线在1秒内发生剧烈变化 *(1秒内光线流明差值>=200)* ，且持续了10秒，此时将打包 **人体传感器实际状态、光线流明值** 上报到平台。
    * 若无人体触发且光线变化缓慢，此状态下每间隔 30分钟，打包 **人体传感器实际状态、光线流明值** 上报到平台。

室内温度值 入口 [#室内温度曲线可视]_ 
--------------------------------------
    系统中可能安装了多个温度传感器，大体分类为回风温度和环境温度。回风温度专指安装在空调机回风口/进风口处的温度传感器，其它温度传感器可安装在室内的参考点用于测量室内温度。
    当测量室内环境的温度传感器，其相邻两次采样的温度差值超过预设某一值时便可触发温度曲线数据集上报平台。
    
    * e.g. 温度传感器在0秒时采样温度为 20.0℃， 在第5秒采样温度值为 20.7℃, 两次采样的温差 (20.7-20.0) > 0.5℃ 此时会触发一次上报环境温度数据。

    * 采样温差大于等于0.5℃， 上报一次室内温度曲线数据。
    * 采样温差持续小于0.5℃时，每间隔10分钟，上报一次室内温度曲线数据。
    * 节能模式下，当发生 空调机通、断电，开、关机，压缩机启、停事件，上报一次室内温度曲线数据。

故障类型
*************
当前系统已知和识别的故障列举如下。当故障发生时系统将产生故障数据上报值平台，平台将对数据进行统计、可视化、告警提示等.

供电异常（采集器入电-断电）
------------------------------
    场景举例:   -----市电-----> 入电 ----> **采集器** ----> 出电 -----> **空调机** 

    采集器的入电断开： 当入电断开。

    * 告警: 将产生 **供电异常告警**  (*入电压低于60v时-认为断电*)。
    * 消警: 恢复供电1分钟后，系统发出 **消警** 到平台。

空调异常断电
---------------------
    场景举例:   -----市电-----> 入电 ----> **采集器** ----> 出电 -----> **空调机** 

    采集器出电断开后，空调机的供电随即断开， 持续60秒后认定为 **空调异常断电** 。
    
    * 告警: 产生 **空调异常断电告警** ，并发送至平台 （检测空调机出电方向的回路电流 < 10mA，且持续60秒） 。
    * 消警: 恢复供电1分钟后，发出 **消警** 消息到平台。

空调故障
---------------------
    节能模式 [#节能模式]_ 开启时，平台下发或者控制器下发“开机运行”指令，随后依据采集器的数据判断，如空调机持续15分钟未能完成“开机运行”指令，认定为 **空调故障** 。
    “开机运行”指令，由采集器直接输出到空调机，每间隔3分钟发送一次。

    * 告警: 空调故障发生后，即刻上报 **空调故障告警** 至平台平台。
    * 消警: 当 **开机运行指令** 下发后，且持续判断空调机“执行指令失败”， 此时会每间隔3分钟重复发送控制指令。当采集器依据反馈数据，判断空调机执行了 **开机运行指令** 成功，会发出“消警”至平台。

制冷不足
---------------------
    采集器与空调机连接示意

        采集器  --------- *控制指令* -------> 空调机

        采集器  <------ *读取回风温度* -----  空调机

    采集器发送 **开机运行** 指令到空调机，随后通过 **回风温度传感器** 判断制冷是否生效。当回风温度

    * 告警: 采集器读取回风温度数值，判断温度下降的速度异常，累计3次降温速度异常， 认定为 **制冷不足**。
    * 消警: 采集器读取回风温度数值，判断温度已达到预期或者温降达到预期，即发送 **制冷不足消警** 至平台平台。
    * **上述告警、消警 触发条件缺少数据实现量化**

异常停止
---------------------
    节能模式 [#节能模式]_ 开启状态，当空调在运行过程（此过程为采集器内的预期过程）周期读取空调机的功率值大小。当空调机的功率值过小时，认定 **空调机异常停止**

    * 告警: 当 **异常停止告警** 产生后，即刻上报至平台。
    * 消警: 当检测空调机功率值达到预期后，发送消警到平台。
    * **空调机功率值过小，持续多长时间???** 

连续运行保护（告警）
---------------------
    节能模式 [#节能模式]_ 开启状态，依据空调机的功率判断，空调机持续运行(制冷)的时间长度。当超过预设时长即认定 **连续运行异常**。

    * 告警：当 **连续运行保护告警** 产生后，即刻上报至平台。
    * 消警: 空调机停止运行后，发出消警至平台。

连续停止保护（告警）
---------------------
    节能模式 [#节能模式]_ 开启状态，依据空调机的功率判断，空调机持续关机的时间长度。当超过预设时长即认定 **连续停止异常**。

    * 告警：当 **连续运行保护告警** 产生后，即刻上报至平台。
    * 消警: 空调机正常运行后，发出消警至平台。

二值量数据-线图
*****************
.. image:: /_static/imags/status_changing.png
    :width: 100%

PowerSave-stragegy
********************
    ...

..........

.. rubric:: 注释

.. [#空调电气数据] 空调电气数据, 即用电数据-空调消耗的电流、电压、功率值的值

    对应平台路径 : *设备管理 -> 站点设备信息 -> 数据报表 -> 用电数据*
.. [#电气可视化数据入口] 电气可视化数据入口

    *设备管理 -> 站点设备信息 -> 数据报表 -> 设备数据 -> 目标控制器 -> 运行时长*

.. [#人体及光线可视化] 人体与光线数据曲线入口

    *设备管理 -> 站点设备信息 -> 数据报表 -> 传感器数据 -> 目标控制器设备 -> 人体模块*

.. [#室内温度曲线可视] 室内温度曲线入口

    *设备管理 -> 站点设备信息 -> 数据报表 -> 传感器数据 -> 目标控制器设备 -> 人体模块*

.. [#节能模式] 节能模式

    *采集器可以远程被配置节能模式“开启”和“关闭”，节能模式开启时采集器将接管空调机的运行，即空调的是否运行由采集器控制。节能模式关闭时，空调机将自主运行*。
